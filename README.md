# Проектная работа "Веб-ларек"

Реализация интернет-магазина "Web Ларёк".

- Используемый стек: HTML, SCSS, TS.
- Для сборки используется Webpack.
- Подключен линтер ESLint.

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

# Архитектура

## Базовый код

В проекте используется архитектурный стиль MVP(Model-View-Presenter). Данная архитектура разделяет слои ответсвенности между классами данных (Model) и отображений (View), координация между которыми происходит посредством контроллера-презентера (Presenter).

Слой данных (Model) - отвечает за загрузку данных по API и данными пользовательского ввода. Так-же в моделях хранится сама бизнес логика приложения.

Слой отображения (View) - отвечает за отображение пользовательского интерфейса.

EventEmitter (Presenter) - связывает интерфейсы и модели данных при срабатывании событий.

## Описание базовых классов

### 1. Класс Api
Описывает реализацию взаимодействия приложения с сервером по HTTP протоколу.
Имеет атрибут конфигурации, в котором хранится путь к серверу, базовые заголовки запроса.
Имеет атрибуты:
```ts
configuration: object // конфигурация для запросов к серверу
```
Имеет методы:
```ts
get: (resource: string, data: object) => Promise<object>
put: (resource: string, data: object) => Promise<object>
patch: (resource: string, data: object) => Promise<object>
post: (resource: string, data: object) => Promise<object>
delete: (resource: string, data: object) => Promise<object>
```


### 2. Класс EventEmitter (Presenter)
Координирует взаимодействие слоев данных и отображения, использует брокер событий.
Имеет атрибуты:
```ts
events: string[] // Список зарегестрированных событий
```
Имеет методы:
```ts
on: (event: string, callback: (data: T) => void) => void // регистрация обработчика события
emit: (event: string, data?: T) => void // отправка события с данными
trigger: (event: string, context?: Partial) => (data: T) => void // создает коллбэк, отправляющий событие при вызове
off: (event: string) => void // снятие регистрации обработчика события
onAll: () => void // начать слушать зарегестрированные события
offAll: () => // сбросить регистрацию всех событий
```


## Описания классов слоя данных (Model)

### 1. Класс CartModel

Используется для заполнения данных клиента и работы с корзиной товаров. Работает с данными, полученными от пользователя.

Имеет следующие атрибуты:

```ts
_products: IProduct[]  // список выбранных продуктов в корзине
_paymentMethod: string // метод оплаты
_address: string       // адрес доставки
_phoneNumber: string   // номер телефона клиента
_email:string          // электронная почта клиента

```

Класс имеет следующие методы:

```ts
addProduct: (product: IProduct) => void    // добавление продукта в корзину
deleteProduct: (product: IProduct) => void // удаление продукта из корзины
setPaymentMethod: (method: string) => void // изменение способа оплаты
setAddress: (address: string) => void      // ввод адреса доставки
setPhoneNumber: (number: string) => void   // ввод номера телефона
setEmail: (email: string) => void          // ввод электронной почты
getItemsCount: () => number                // возвращает количество заказов в корзине
getItemsTotal: () => number                // итоговая сумма покупки
isValid: () => boolean                     // проверяет, валидны ли данные корзины
```

### 3. Класс ApiProductsModel

Этот класс наследуется от класса [Api](### 1. Класс Api) и отвечает за взаимодействие со товарами на сервере
Имеет методы:
```ts
getProductList: () => IProduct[] // получить список товаров с сервера
getProduct(uuid: string) => IProduct // получить информацию по конкретному товару
```

### 4. Класс ApiOrderModel

Этот класс наследуется от класса [Api](### 1. Класс Api) и отвечает за оформление заказа на сервере
```ts
postOrder: () => object // отправить данные по заказу на сервер
```

## Классы отображения (View)

### 1. Класс BaseView (абстрактный)

Базовый класс отображения, от которого будут наследоваться остальные классы.
Класс имеет следующие атрибуты:
```ts
_isConfiguredListeners: boolean // флаг установки слушателей
```
Класс имеет следующие методы:
```ts
 new (root: HTMLElement, settings: S) => this // чтобы при копировании создавать дочерний класс, не зная его имени
 copy(settings?: S): typeof this // копирующий конструктор, чтобы настроить один раз и дальше использовать копии отображения везде, но при желании можем что-то поменять, например обработчики событий
 _setupListeners(callback: () => void) // метод для установки слушателей из рендера или при инициализации
_init() {} // начальная инициализация, здесь можно создать элементы, повесить слушатели и т.д.
 render(data: unknown): HTMLElement // рендер, вызывается когда надо обновить отображение с данными

```

### 2. Класс ProductView

Используется для отображения информации о товаре, наследуется от BaseView и реализует интерфейс IView.
Класс имеет следующие атрибуты:
```ts
_product: IProduct // информация для отображения товара
variant: string // значение, по которомму идет ветвление для отображения в списке на главной странице или в корзине
```
Класс имеет следующие методы:
```ts
_setAddProductCallback: (product: IProduct) => void; // обработчик события нажатия на кнопку "В корзину"
_setOnClickCallback: () => void; // обработчик нажатия на карточку с товаром
```

### 3. Класс CartView

Используется для отображения наполнения корзины, наследуется от BaseView и реализует интерфейс IView.
Класс имеет следующие атрибуты:
```ts
_cart: ICart // информация для отображения корзины
```
Класс имеет следующие методы:
```ts
_setAddressCallback: (address: string) => void; // обработчик изменения поля ввода адреса
_setPhoneNumberCallback: (phoneNumber: string) => void; // обработчик изменения поля ввода телефона
_setPaymentMethodCallback: (paymentMethod: string) => void; // обработчик нажатия на кнопки типа оплаты
_setEmailCallback: (email: string) => void; // обработчик изменения поля ввода емейла
_setDeleteItemCallback: (product: IProduct) => void; // обработчик нажатия на кнопку удаления товара
_setCheckoutButtonCallback: () => void; // обработчик нажатия на кнопку "Оформить"
_setProceedAddressButtonCallback: () => void; // обработчик нажатия на кнопку "далее" на этапе ввода адреса и типа оплаты
_setProceedContactsButtonCallback: () => void; // обработчик нажатия на кнопку "оплатить"
_isValid: () => boolean; // проверка корректности ввода данных в инпуты
```

### 4. Класс SuccessOrderView

Используется для отрисовки информации об успешном заказе, наследуется от BaseView и реализует интерфейс IView.

Класс имеет следующие методы:
```ts
_setButtonCallback: () => void; // обработчик нажатия на кнопку "За новыми покупками"
```

### 5. Класс Modal

Используется для отображения модальных окон, наследуется от BaseView и реализует интерфейс IView.

Класс имеет следующие методы:
```ts
_setOpenCallback: () => void // открытие модального окна
_setCloseCallback: () => void // закрытие модального окна
```
